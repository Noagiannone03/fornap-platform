<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiement - FORNAP</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components.css">
</head>
<body>
    <!-- Placeholder pour la navbar - sera remplac√©e par le composant -->
    <div id="navbar-placeholder"></div>

    <!-- ========================================
         CONTENU PRINCIPAL
         ======================================== -->
    <main class="main-content">
        
        <!-- Barre de progression -->
        <section class="progress-section">
            <div class="container">
                <div class="progress-bar">
                    <div class="progress-step completed">
                        <div class="step-number">1</div>
                        <div class="step-label">Forfait</div>
                    </div>
                    <div class="progress-line completed"></div>
                    <div class="progress-step active" id="currentStep">
                        <div class="step-number">2</div>
                        <div class="step-label">Compte</div>
                    </div>
                    <div class="progress-line"></div>
                    <div class="progress-step">
                        <div class="step-number">3</div>
                        <div class="step-label">Paiement</div>
                    </div>
                    <div class="progress-line"></div>
                    <div class="progress-step">
                        <div class="step-number">4</div>
                        <div class="step-label">Infos</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section R√©capitulatif Forfait -->
        <section class="selected-plan-section">
            <div class="container">
                <div class="plan-summary-card" id="planSummary">
                    <!-- Contenu g√©n√©r√© dynamiquement -->
                </div>
            </div>
        </section>

        <!-- Section Authentification -->
        <section id="authSection" class="auth-section">
            <div class="container">
                <div class="auth-container">
                    <div class="auth-card">
                        <div class="auth-header">
                            <h2>Cr√©er votre compte FORNAP</h2>
                            <p>Pour finaliser votre adh√©sion, cr√©ez votre compte membre ou connectez-vous si vous en avez d√©j√† un.</p>
                        </div>

                        <!-- Formulaire Inscription -->
                        <div id="signupForm" class="auth-form">
                            <h3>Nouvelle inscription</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="signupFirstName">Pr√©nom</label>
                                    <input type="text" id="signupFirstName" class="input-field" placeholder="Jean" required>
                                </div>
                                <div class="form-group">
                                    <label for="signupLastName">Nom</label>
                                    <input type="text" id="signupLastName" class="input-field" placeholder="Dupont" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="signupEmail">Email</label>
                                <input type="email" id="signupEmail" class="input-field" placeholder="votre@email.com" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="signupPassword">Mot de passe</label>
                                <input type="password" id="signupPassword" class="input-field" placeholder="Minimum 6 caract√®res" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="signupConfirmPassword">Confirmer le mot de passe</label>
                                <input type="password" id="signupConfirmPassword" class="input-field" placeholder="Confirmez votre mot de passe" required>
                            </div>
                            
                            <button type="button" id="signupBtn" class="btn btn-primary btn-full btn-large">
                                Cr√©er mon compte
                            </button>
                        </div>

                        <!-- S√©parateur -->
                        <div class="auth-separator">
                            <div class="separator-line"></div>
                            <span class="separator-text">ou</span>
                            <div class="separator-line"></div>
                        </div>

                        <!-- Formulaire Connexion -->
                        <div id="loginForm" class="auth-form">
                            <h3>D√©j√† membre ?</h3>
                            
                            <div class="form-group">
                                <label for="loginEmail">Email</label>
                                <input type="email" id="loginEmail" class="input-field" placeholder="votre@email.com" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="loginPassword">Mot de passe</label>
                                <input type="password" id="loginPassword" class="input-field" placeholder="Votre mot de passe" required>
                            </div>
                            
                            <button type="button" id="loginBtn" class="btn btn-secondary btn-full btn-large">
                                Se connecter
                            </button>
                            
                            <p class="text-center mt-4">
                                <a href="#" class="forgot-password">Mot de passe oubli√© ?</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Paiement -->
        <section id="paymentSection" class="payment-section hidden">
            <div class="container">
                <div class="payment-container">
                    <div class="payment-card">
                        <div class="payment-header">
                            <h2>Finaliser votre paiement</h2>
                            <p class="demo-notice">
                                üé≠ <strong>Mode D√©mo</strong> - Simulation de paiement. Aucun montant ne sera d√©bit√©.
                            </p>
                        </div>

                        <!-- M√©thodes de paiement -->
                        <div class="payment-methods">
                            <h3>M√©thode de paiement</h3>
                            <div class="method-options">
                                <label class="method-option active">
                                    <input type="radio" name="paymentMethod" value="card" checked>
                                    <div class="method-content">
                                        <span class="method-icon">üí≥</span>
                                        <span class="method-name">Carte bancaire</span>
                                    </div>
                                </label>
                                <label class="method-option">
                                    <input type="radio" name="paymentMethod" value="paypal">
                                    <div class="method-content">
                                        <span class="method-icon">üÖøÔ∏è</span>
                                        <span class="method-name">PayPal</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- D√©tails carte -->
                        <div class="card-details" id="cardDetails">
                            <h4>Informations de la carte</h4>
                            
                            <div class="form-group">
                                <label for="cardNumber">Num√©ro de carte</label>
                                <input type="text" id="cardNumber" class="input-field" placeholder="1234 5678 9012 3456" maxlength="19" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expiryDate">Date d'expiration</label>
                                    <input type="text" id="expiryDate" class="input-field" placeholder="MM/AA" maxlength="5" required>
                                </div>
                                <div class="form-group">
                                    <label for="cvv">CVV</label>
                                    <input type="text" id="cvv" class="input-field" placeholder="123" maxlength="4" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cardName">Nom sur la carte</label>
                                <input type="text" id="cardName" class="input-field" placeholder="Jean Dupont" required>
                            </div>
                        </div>

                        <!-- D√©tails PayPal -->
                        <div class="paypal-details hidden" id="paypalDetails">
                            <div class="paypal-info">
                                <p>Vous serez redirig√© vers PayPal pour finaliser votre paiement en toute s√©curit√©.</p>
                                <div class="paypal-button">
                                    <button class="paypal-btn">
                                        üÖøÔ∏è Payer avec PayPal
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- R√©sum√© de commande -->
                        <div class="order-summary">
                            <h4>R√©sum√© de votre commande</h4>
                            <div class="summary-content" id="orderSummary">
                                <!-- Contenu g√©n√©r√© dynamiquement -->
                            </div>
                        </div>

                        <!-- Conditions -->
                        <div class="terms-section">
                            <label class="checkbox-label">
                                <input type="checkbox" id="acceptTerms" required>
                                <span class="checkmark"></span>
                                J'accepte les <a href="#" target="_blank">conditions g√©n√©rales</a> 
                                et la <a href="#" target="_blank">politique de confidentialit√©</a>
                            </label>
                            
                            <label class="checkbox-label">
                                <input type="checkbox" id="newsletter">
                                <span class="checkmark"></span>
                                Je souhaite recevoir les actualit√©s FORNAP par email
                            </label>
                        </div>

                        <!-- Actions -->
                        <div class="payment-actions">
                            <button type="button" class="btn btn-secondary btn-large" onclick="goBackToAuth()">
                                ‚Üê Retour
                            </button>
                            <button type="button" id="processPaymentBtn" class="btn btn-primary btn-large">
                                Finaliser le paiement
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Placeholder pour le footer - sera remplac√© par le composant -->
    <div id="footer-placeholder"></div>

    <!-- ========================================
         MODAL DE CHARGEMENT
         ======================================== -->
    <div id="loadingModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <h3>Traitement en cours...</h3>
                <p id="loadingText">Pr√©paration de votre adh√©sion</p>
                <div class="loading-steps">
                    <div class="step" id="loadingStep1">‚úì V√©rification des informations</div>
                    <div class="step" id="loadingStep2">üîÑ Traitement du paiement</div>
                    <div class="step" id="loadingStep3">üìÑ Cr√©ation du compte membre</div>
                    <div class="step" id="loadingStep4">üéâ Finalisation</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================
         CONTAINER MESSAGES
         ======================================== -->
    <div id="messageContainer"></div>

    <!-- ========================================
         SCRIPTS FIREBASE
         ======================================== -->
    <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore-compat.js"></script>

    <!-- ========================================
         JAVASCRIPT PRINCIPAL
         ======================================== -->
    <script>
        console.log('üöÄ FORNAP - Page Paiement');

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyALz161yfiLaOeHU82DQNJV4PkzAXO1wzM",
            authDomain: "nap-7aa80.firebaseapp.com",
            projectId: "nap-7aa80",
            storageBucket: "nap-7aa80.firebasestorage.app",
            messagingSenderId: "434731738248",
            appId: "1:434731738248:web:481644f3a6e809c06d2b3d",
            measurementId: "G-3HVC6HNG02"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        console.log('‚úÖ Firebase initialis√©');

        // Variables globales
        let currentUser = null;
        let selectedPlan = null;
        let currentStep = 'auth'; // auth, payment, processing

        // Fonctions utilitaires
        function showMessage(message, type = 'info') {
            console.log('üí¨ Message:', message, type);
            
            const container = document.getElementById('messageContainer');
            const messageElement = document.createElement('div');
            messageElement.className = `message ${type}`;
            messageElement.textContent = message;
            container.appendChild(messageElement);

            setTimeout(() => messageElement.classList.add('show'), 100);
            setTimeout(() => {
                messageElement.classList.remove('show');
                setTimeout(() => messageElement.remove(), 300);
            }, 4000);
        }

        function showLoading(show = true) {
            const modal = document.getElementById('loadingModal');
            if (show) {
                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        }

        function updateProgress(stepNumber) {
            // Mettre √† jour la barre de progression
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                if (index < stepNumber - 1) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (index === stepNumber - 1) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });

            document.querySelectorAll('.progress-line').forEach((line, index) => {
                if (index < stepNumber - 1) {
                    line.classList.add('completed');
                } else {
                    line.classList.remove('completed');
                }
            });
        }

        function displaySelectedPlan() {
            const planData = sessionStorage.getItem('selectedPlan');
            if (!planData) {
                showMessage('Aucun forfait s√©lectionn√©. Redirection...', 'error');
                setTimeout(() => window.location.href = '../pages/membership.html', 2000);
                return;
            }

            selectedPlan = JSON.parse(planData);
            console.log('üìã Forfait r√©cup√©r√©:', selectedPlan);

            const planSummary = document.getElementById('planSummary');
            planSummary.innerHTML = `
                <div class="plan-info">
                    <h3>Forfait s√©lectionn√© : ${selectedPlan.name}</h3>
                    <div class="plan-price">
                        <span class="amount">${selectedPlan.price}‚Ç¨</span>
                        <span class="period">/mois</span>
                    </div>
                </div>
                <div class="plan-features">
                    <ul>
                        ${selectedPlan.features.map(feature => `<li>${feature}</li>`).join('')}
                    </ul>
                </div>
            `;

            // Mettre √† jour le r√©sum√© de commande
            updateOrderSummary();
        }

        function updateOrderSummary() {
            if (!selectedPlan) return;

            const orderSummary = document.getElementById('orderSummary');
            const basePrice = selectedPlan.price;
            const taxRate = 0.20;
            const taxAmount = basePrice * taxRate;
            const totalPrice = basePrice + taxAmount;

            orderSummary.innerHTML = `
                <div class="summary-line">
                    <span>Adh√©sion ${selectedPlan.name}</span>
                    <span>${basePrice.toFixed(2)}‚Ç¨</span>
                </div>
                <div class="summary-line">
                    <span>TVA (20%)</span>
                    <span>${taxAmount.toFixed(2)}‚Ç¨</span>
                </div>
                <div class="summary-line total">
                    <span><strong>Total</strong></span>
                    <span><strong>${totalPrice.toFixed(2)}‚Ç¨</strong></span>
                </div>
            `;
        }

        // Gestion de l'authentification
        auth.onAuthStateChanged(function(user) {
            console.log('Changement √©tat auth:', user ? user.email : 'd√©connect√©');
            currentUser = user;
            
            if (user && currentStep === 'auth') {
                // Utilisateur connect√©, passer au paiement
                proceedToPayment();
            }
        });

        async function handleSignup() {
            const firstName = document.getElementById('signupFirstName').value;
            const lastName = document.getElementById('signupLastName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;

            if (!firstName || !lastName || !email || !password) {
                showMessage('Veuillez remplir tous les champs', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showMessage('Les mots de passe ne correspondent pas', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage('Le mot de passe doit contenir au moins 6 caract√®res', 'error');
                return;
            }

            console.log('üîê Cr√©ation compte:', email);

            try {
                showLoading(true);
                
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // Sauvegarder les informations du profil
                sessionStorage.setItem('userProfile', JSON.stringify({
                    firstName,
                    lastName,
                    email
                }));

                showMessage('Compte cr√©√© avec succ√®s !', 'success');
                
                setTimeout(() => {
                    showLoading(false);
                    proceedToPayment();
                }, 1500);

            } catch (error) {
                showLoading(false);
                console.error('‚ùå Erreur cr√©ation compte:', error);
                showMessage('Erreur lors de la cr√©ation du compte: ' + error.message, 'error');
            }
        }

        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showMessage('Veuillez remplir tous les champs', 'error');
                return;
            }

            console.log('üîê Connexion:', email);

            try {
                showLoading(true);
                
                await auth.signInWithEmailAndPassword(email, password);
                showMessage('Connexion r√©ussie !', 'success');
                
                setTimeout(() => {
                    showLoading(false);
                    proceedToPayment();
                }, 1500);

            } catch (error) {
                showLoading(false);
                console.error('‚ùå Erreur connexion:', error);
                showMessage('Email ou mot de passe incorrect', 'error');
            }
        }

        function proceedToPayment() {
            console.log('üè¶ Passage au paiement');
            currentStep = 'payment';
            
            // Masquer l'authentification
            document.getElementById('authSection').classList.add('hidden');
            
            // Afficher le paiement
            document.getElementById('paymentSection').classList.remove('hidden');
            
            // Mettre √† jour la progression
            updateProgress(3);

            // Pr√©-remplir le nom sur la carte si disponible
            const userProfile = sessionStorage.getItem('userProfile');
            if (userProfile) {
                const profile = JSON.parse(userProfile);
                document.getElementById('cardName').value = `${profile.firstName} ${profile.lastName}`;
            }
        }

        function goBackToAuth() {
            console.log('‚Ü©Ô∏è Retour √† l\'authentification');
            currentStep = 'auth';
            
            // Afficher l'authentification
            document.getElementById('authSection').classList.remove('hidden');
            
            // Masquer le paiement
            document.getElementById('paymentSection').classList.add('hidden');
            
            // Mettre √† jour la progression
            updateProgress(2);
        }

        async function processPayment() {
            console.log('üí≥ Traitement du paiement');
            
            // V√©rifications
            const acceptTerms = document.getElementById('acceptTerms').checked;
            if (!acceptTerms) {
                showMessage('Veuillez accepter les conditions g√©n√©rales', 'error');
                return;
            }

            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
            
            if (paymentMethod === 'card') {
                const cardNumber = document.getElementById('cardNumber').value;
                const expiryDate = document.getElementById('expiryDate').value;
                const cvv = document.getElementById('cvv').value;
                const cardName = document.getElementById('cardName').value;

                if (!cardNumber || !expiryDate || !cvv || !cardName) {
                    showMessage('Veuillez remplir toutes les informations de carte', 'error');
                    return;
                }
            }

            try {
                showLoading(true);
                updateProgress(4);
                
                // Simulation du traitement
                document.getElementById('loadingText').textContent = 'Traitement du paiement...';
                
                // √âtape 1
                setTimeout(() => {
                    document.getElementById('loadingStep1').classList.add('completed');
                    document.getElementById('loadingStep2').classList.add('active');
                    document.getElementById('loadingText').textContent = 'V√©rification bancaire...';
                }, 1000);

                // √âtape 2
                setTimeout(() => {
                    document.getElementById('loadingStep2').classList.add('completed');
                    document.getElementById('loadingStep2').classList.remove('active');
                    document.getElementById('loadingStep3').classList.add('active');
                    document.getElementById('loadingText').textContent = 'Cr√©ation du profil membre...';
                }, 3000);

                // √âtape 3
                setTimeout(() => {
                    document.getElementById('loadingStep3').classList.add('completed');
                    document.getElementById('loadingStep3').classList.remove('active');
                    document.getElementById('loadingStep4').classList.add('active');
                    document.getElementById('loadingText').textContent = 'Finalisation...';
                }, 5000);

                // Finalisation
                setTimeout(() => {
                    document.getElementById('loadingStep4').classList.add('completed');
                    
                    // Sauvegarder les donn√©es du paiement
                    const paymentData = {
                        plan: selectedPlan,
                        method: paymentMethod,
                        timestamp: new Date().toISOString(),
                        status: 'completed'
                    };
                    
                    sessionStorage.setItem('paymentData', JSON.stringify(paymentData));
                    
                    // Sauvegarder les donn√©es de membership pour profile-setup
                    const membershipData = {
                        planId: selectedPlan.id,
                        planName: selectedPlan.name,
                        planPrice: selectedPlan.price,
                        period: selectedPlan.period,
                        paymentMethod: paymentMethod,
                        paidAt: new Date().toISOString()
                    };
                    
                    sessionStorage.setItem('membershipData', JSON.stringify(membershipData));
                    
                    showLoading(false);
                    
                    // Redirection vers profile-setup pour finaliser le profil
                    showMessage('Paiement r√©ussi ! Finalisation de votre profil...', 'success');
                    setTimeout(() => {
                        window.location.href = 'profile-setup.html';
                    }, 1500);
                }, 7000);

            } catch (error) {
                showLoading(false);
                console.error('‚ùå Erreur paiement:', error);
                showMessage('Erreur lors du traitement du paiement', 'error');
            }
        }

        // Gestion des m√©thodes de paiement
        function handlePaymentMethodChange() {
            const cardDetails = document.getElementById('cardDetails');
            const paypalDetails = document.getElementById('paypalDetails');
            const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked').value;

            if (selectedMethod === 'card') {
                cardDetails.classList.remove('hidden');
                paypalDetails.classList.add('hidden');
            } else {
                cardDetails.classList.add('hidden');
                paypalDetails.classList.remove('hidden');
            }
        }

        // Formatage des champs de carte
        function formatCardNumber(input) {
            let value = input.value.replace(/\s/g, '');
            let formattedValue = value.replace(/(.{4})/g, '$1 ').trim();
            input.value = formattedValue;
        }

        function formatExpiryDate(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            input.value = value;
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ DOM charg√© - Page Paiement');

            // R√©cup√©rer et afficher le forfait s√©lectionn√©
            displaySelectedPlan();

            // √âv√©nements d'authentification
            document.getElementById('signupBtn')?.addEventListener('click', handleSignup);
            document.getElementById('loginBtn')?.addEventListener('click', handleLogin);

            // √âv√©nements de paiement
            document.getElementById('processPaymentBtn')?.addEventListener('click', processPayment);
            
            // Gestion des m√©thodes de paiement
            document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
                radio.addEventListener('change', handlePaymentMethodChange);
            });

            // Formatage des champs de carte
            document.getElementById('cardNumber')?.addEventListener('input', (e) => formatCardNumber(e.target));
            document.getElementById('expiryDate')?.addEventListener('input', (e) => formatExpiryDate(e.target));

            console.log('üéØ FORNAP Paiement pr√™t !');
        });
    </script>

    <style>
        /* Styles sp√©cifiques √† la page paiement */
        .progress-section {
            background-color: var(--gris-tres-clair);
            padding: var(--space-8) 0;
            border-bottom: 2px solid var(--noir-principal);
        }

        .progress-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 600px;
            margin: 0 auto;
            gap: var(--space-4);
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-2);
        }

        .step-number {
            width: 40px;
            height: 40px;
            border: 2px solid var(--gris-moyen);
            background-color: var(--blanc-principal);
            color: var(--gris-moyen);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-bold);
            transition: var(--transition-base);
        }

        .progress-step.completed .step-number {
            background-color: var(--noir-principal);
            color: var(--blanc-principal);
            border-color: var(--noir-principal);
        }

        .progress-step.active .step-number {
            background-color: var(--blanc-principal);
            color: var(--noir-principal);
            border-color: var(--noir-principal);
            border-width: 3px;
        }

        .step-label {
            font-size: var(--text-sm);
            color: var(--gris-moyen);
            font-weight: var(--font-medium);
        }

        .progress-step.completed .step-label,
        .progress-step.active .step-label {
            color: var(--noir-principal);
            font-weight: var(--font-semibold);
        }

        .progress-line {
            width: 60px;
            height: 2px;
            background-color: var(--gris-clair);
        }

        .progress-line.completed {
            background-color: var(--noir-principal);
        }

        .selected-plan-section {
            padding: var(--space-8) 0;
            background-color: var(--blanc-principal);
        }

        .plan-summary-card {
            background-color: var(--gris-tres-clair);
            border: 2px solid var(--noir-principal);
            padding: var(--space-6);
            box-shadow: var(--shadow-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .plan-info h3 {
            margin-bottom: var(--space-2);
            color: var(--noir-principal);
        }

        .plan-price {
            display: flex;
            align-items: baseline;
            gap: var(--space-2);
        }

        .plan-price .amount {
            font-size: var(--text-2xl);
            font-weight: var(--font-bold);
            color: var(--noir-principal);
        }

        .plan-price .period {
            color: var(--gris-moyen);
        }

        .plan-features ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .plan-features li {
            font-size: var(--text-sm);
            color: var(--gris-moyen);
            background-color: var(--blanc-principal);
            padding: var(--space-1) var(--space-3);
            border: 1px solid var(--gris-clair);
        }

        .auth-section,
        .payment-section {
            padding: var(--space-16) 0;
            background-color: var(--blanc-principal);
        }

        .auth-container,
        .payment-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .auth-card,
        .payment-card {
            background-color: var(--gris-tres-clair);
            border: 2px solid var(--noir-principal);
            padding: var(--space-8);
            box-shadow: var(--shadow-md);
        }

        .auth-header,
        .payment-header {
            text-align: center;
            margin-bottom: var(--space-8);
            border-bottom: 2px solid var(--noir-principal);
            padding-bottom: var(--space-6);
        }

        .auth-header h2,
        .payment-header h2 {
            margin-bottom: var(--space-4);
        }

        .demo-notice {
            background-color: var(--attention);
            color: var(--noir-principal);
            padding: var(--space-4);
            border: 2px solid var(--noir-principal);
            margin-top: var(--space-4);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
        }

        .auth-form {
            margin-bottom: var(--space-6);
        }

        .auth-form h3 {
            margin-bottom: var(--space-6);
            color: var(--noir-principal);
            border-bottom: 1px solid var(--gris-clair);
            padding-bottom: var(--space-3);
        }

        .auth-separator {
            display: flex;
            align-items: center;
            margin: var(--space-8) 0;
        }

        .separator-line {
            flex: 1;
            height: 1px;
            background-color: var(--gris-clair);
        }

        .separator-text {
            padding: 0 var(--space-4);
            color: var(--gris-moyen);
            font-weight: var(--font-medium);
        }

        .forgot-password {
            color: var(--gris-moyen);
            font-size: var(--text-sm);
            text-decoration: underline;
        }

        .payment-methods {
            margin-bottom: var(--space-8);
        }

        .payment-methods h3 {
            margin-bottom: var(--space-4);
            color: var(--noir-principal);
        }

        .method-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-4);
        }

        .method-option {
            position: relative;
            cursor: pointer;
            display: block;
        }

        .method-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .method-content {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            border: 2px solid var(--gris-clair);
            background-color: var(--blanc-principal);
            transition: var(--transition-base);
        }

        .method-option:hover .method-content {
            border-color: var(--noir-principal);
        }

        .method-option.active .method-content,
        .method-option input[type="radio"]:checked + .method-content {
            border-color: var(--noir-principal);
            background-color: var(--gris-tres-clair);
        }

        .method-icon {
            font-size: var(--text-xl);
        }

        .method-name {
            font-weight: var(--font-medium);
            color: var(--noir-principal);
        }

        .card-details,
        .paypal-details {
            background-color: var(--blanc-principal);
            border: 2px solid var(--gris-clair);
            padding: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .card-details h4 {
            margin-bottom: var(--space-4);
            color: var(--noir-principal);
        }

        .paypal-details {
            text-align: center;
        }

        .paypal-btn {
            background-color: #0070ba;
            color: white;
            padding: var(--space-4) var(--space-8);
            border: 2px solid var(--noir-principal);
            font-weight: var(--font-semibold);
            cursor: pointer;
            transition: var(--transition-base);
        }

        .paypal-btn:hover {
            background-color: #005ea6;
        }

        .order-summary {
            background-color: var(--blanc-principal);
            border: 2px solid var(--noir-principal);
            padding: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .order-summary h4 {
            margin-bottom: var(--space-4);
            color: var(--noir-principal);
            border-bottom: 1px solid var(--gris-clair);
            padding-bottom: var(--space-2);
        }

        .summary-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--gris-clair);
        }

        .summary-line:last-child {
            border-bottom: none;
        }

        .summary-line.total {
            border-top: 2px solid var(--noir-principal);
            margin-top: var(--space-3);
            padding-top: var(--space-3);
            font-size: var(--text-lg);
        }

        .terms-section {
            background-color: var(--blanc-principal);
            border: 2px solid var(--gris-clair);
            padding: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .checkbox-label {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
            cursor: pointer;
            font-size: var(--text-sm);
            line-height: 1.5;
        }

        .checkbox-label:last-child {
            margin-bottom: 0;
        }

        .checkbox-label input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid var(--noir-principal);
            background-color: var(--blanc-principal);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-base);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark {
            background-color: var(--noir-principal);
            color: var(--blanc-principal);
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark::after {
            content: '‚úì';
            font-weight: var(--font-bold);
        }

        .checkbox-label a {
            color: var(--noir-principal);
            text-decoration: underline;
        }

        .payment-actions {
            display: flex;
            gap: var(--space-4);
            justify-content: space-between;
        }

        .payment-actions .btn-large {
            min-width: 180px;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            position: relative;
            background-color: var(--blanc-principal);
            border: 2px solid var(--noir-principal);
            padding: var(--space-8);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-lg);
        }

        .loading-content {
            text-align: center;
        }

        .loading-content h3 {
            color: var(--noir-principal);
            margin-bottom: var(--space-4);
        }

        .loading-content p {
            color: var(--gris-moyen);
            margin-bottom: var(--space-8);
        }

        .loading-steps {
            text-align: left;
        }

        .loading-steps .step {
            padding: var(--space-3) 0;
            color: var(--gris-moyen);
            border-bottom: 1px solid var(--gris-clair);
        }

        .loading-steps .step:last-child {
            border-bottom: none;
        }

        .loading-steps .step.active {
            color: var(--noir-principal);
            font-weight: var(--font-semibold);
        }

        .loading-steps .step.completed {
            color: var(--succes);
        }

        .security-badges {
            display: flex;
            gap: var(--space-4);
            justify-content: center;
            align-items: center;
            font-size: var(--text-sm);
            color: var(--gris-clair);
        }

        @media (max-width: 768px) {
            .progress-bar {
                flex-wrap: wrap;
                gap: var(--space-2);
            }

            .progress-line {
                display: none;
            }

            .progress-step {
                flex-direction: row;
                gap: var(--space-2);
            }

            .plan-summary-card {
                flex-direction: column;
                gap: var(--space-4);
                text-align: center;
            }

            .plan-features ul {
                justify-content: center;
            }

            .method-options {
                grid-template-columns: 1fr;
            }

            .payment-actions {
                flex-direction: column;
            }

            .auth-card,
            .payment-card {
                padding: var(--space-6);
            }
        }
    </style>

    <!-- ========================================
         COMPOSANTS FORNAP
         ======================================== -->
    <script src="../assets/js/config.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/auth-service.js"></script>
    <script src="../assets/js/components.js"></script>

    <script>
        // Initialisation des composants FORNAP
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Initialisation composants FORNAP - Payment');

            // Injecter la navbar
            const navbarPlaceholder = document.getElementById('navbar-placeholder');
            if (navbarPlaceholder) {
                navbarPlaceholder.outerHTML = FornapComponents.generateNavbar('payment', '../');
            }

            // Injecter le footer
            const footerPlaceholder = document.getElementById('footer-placeholder');
            if (footerPlaceholder) {
                footerPlaceholder.outerHTML = FornapComponents.generateFooter('../');
            }

            // Initialiser les √©v√©nements apr√®s injection
            setTimeout(() => {
                FornapComponents.initNavbarEvents('../', {
                    onLogin: () => {
                        console.log('Login demand√©');
                    },
                    onLogout: handleLogout
                });
            }, 100);
        });
    </script>
</body>
</html> 